proxy (mole?)
=============

This is a cloud service written in threaded Rust.

What kind of connections does it handle?

 * register host
 * https://{{DOMAIN}}/{{HOST}}/
   - persists a push-notification identifier (e.g. APNS device token) for this host

 * register TOTP secret
 * https://{{DOMAIN}}/{{HOST}}/consumer/{{CONSUMER}}
   - persists a TOTP secret, generated by the host, associating a consumer (by email or phone#) with
     that host

 * pseudo-push-notification backchannel
 * wss://{{DOMAIN}}/{{HOST}}/pseudo-push-notification/
   - long-lived TCP connection from host; replaces "real" push notification mechanisms when the host is actively running

 * proxy-auth
 * https://2fa.{{HOST}}.{{DOMAIN}}/{{PATH}}
   - must be a separate domain: ssl terminates at the proxy!
   - if jwt cookie is missing or expired:
     - perform TOTP 2fa before involving the host, using our shared secret, if necessary
     - emit a jwt cookie
   - redirect to the equivalent "proxy"

 * proxy
 * https://{{HOST}}.{{DOMAIN}}/{{PATH}}
   - must be a separate domain: ssl terminates at the host!
   - send push notification to server with a tunnel nonce

 * tunnel
 * wss://{{DOMAIN}}/{{HOST}}/tunnel/{{NONCE}}/
   - connect the tunnel session to the proxy session
